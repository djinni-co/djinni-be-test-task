{% macro wish_category(category, item) %}
  <li class="category">
    <div class="checkbox dropdown-item">
      <label>
        <form method="post"
              class="m-0"
              action="/wishlist/"
              hx-post="/wishlist/"
              hx-target="closest .category"
              hx-swap="outerHTML"
              hx-trigger="change">
              {{ csrf_input }}
              <input type="hidden" name="id" value="{{ item.id }}">
              <input type="hidden" name="categoryId" value="{{ category.id }}">
              <input type="checkbox" {% if item.wishlists.filter(category=category).exists() %} checked {% endif %}> {{category.name}}
          </form>
      </label>
    </div>
  </li>
{% endmacro -%}

{% macro card(item) %}
  <div class="card text-bg-dark mb-4" style="width: 18rem;">
    <img src="{{ item.pic }}" style="aspect-ratio: 300/300"
         class="card-img-top" alt="{{ item.name }}">

    <div class="card-body d-flex justify-content-between align-items-center">
      <h5 class="card-title m-0 p-0">{{ item.name }}</h5>

        <div class="btn-group">
          <form method="post"
                class="m-0"
                action="/wishlist/"
                hx-post="/wishlist/"
                hx-target="closest .card"
                hx-swap="outerHTML">
          {{ csrf_input }}
          <input type="hidden" name="id" value="{{ item.id }}">
          <button type="submit" class="btn btn-danger">
            {% if item.wishlists.filter(category=None).exists() %}
              <i class="bi bi-bookmark-fill"></i>
            {% else %}
              <i class="bi bi-bookmark"></i>
            {% endif %}
             Save
          </button>
          </form>
          <button type="button" class="btn btn-danger dropdown-toggle dropdown-toggle-split" data-bs-toggle="dropdown" aria-expanded="false">
            <span class="visually-hidden">Toggle Dropdown</span>
          </button>
          <ul class="dropdown-menu" id="dropmenu">
              {% for category in categories %}
                  {{ wish_category(category, item) }}
              {% endfor %}
            <li><hr class="dropdown-divider"></li>
            <li>
              <form method="post"
                    class="m-0 dropdown-item"
                    action="/wishcategory/"
                    hx-post="/wishcategory/"
                    hx-target=".dropdown-menu"
                    hx-swap="afterbegin">
              {{ csrf_input }}
              <div class="input-group mb-3">
                <input type="text" name="name" class="form-control" placeholder="Catalog name" aria-describedby="basic-addon2">
                <input type="hidden" name="itemId" value="{{ item.id }}">
                <div class="input-group-append">
                  <button class="btn btn-outline-secondary" type="submit">Create</button>
                </div>
              </div>
              </form>
            </li>
          </ul>
        </div>
    </div>
  </div>
{% endmacro -%}

<html>
  <head>
    <title>Wishlist</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.3/font/bootstrap-icons.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://unpkg.com/htmx.org@1.8.5"></script>
    <link href="data:image/x-icon;base64," rel="icon" type="image/x-icon" />

  </head>
  <body class="container">
    <h1 class="my-5 px-5">Wishlist anybody you want</h1>

    <ul class="d-flex flex-wrap justify-content-evenly gap-2">
      {% for item in items %}
        {{ card(item) }}
      {% endfor %}
    </ul>
  </body>
</html>
