{% macro wish_item(wish_item, item_id) %}
  <form
    method="put"
    action="/wishlist/"
    hx-put="/wishlist/"
    hx-trigger="change"
    >
    <div class="form-check m-3">
      <label class="form-check-label">
        <input type="hidden" name="item_id" value="{{item_id}}">
        <input type="hidden" name="name" value="{{wish_item.name}}">
        <input 
          class="form-check-input"
          type="checkbox"
          {% if wish_item.item_id|int == item_id|int %} checked {% endif %}
          >
        {{ wish_item.name }}
      </label>
    </div>
  </form>
{% endmacro -%}

{% macro card(item) %}
  <div class="card text-bg-dark mb-4" style="width: 18rem;">
    <img src="{{ item.pic }}" style="aspect-ratio: 300/300"
         class="card-img-top" alt="{{ item.name }}">

    <div class="card-body d-flex justify-content-between align-items-center">
      <h5 class="card-title m-0 p-0">{{ item.name }}</h5>

        <div class="btn-group">

          <button
            type="button"
            class="btn btn-danger"
            hx-put="/wishlist/"
            hx-vals='{"item_id": {{ item.id }}}'
            hx-swap="innerHTML"
            >
            {% if item.wishlists.filter(name=None).exists() %}
              <i class="bi bi-bookmark-fill"></i>
            {% else %}
              <i class="bi bi-bookmark"></i>
            {% endif %}
             Save
          </button>

          <button
            class="btn btn-danger dropdown-toggle dropdown-toggle-split"
            aria-expanded="false"
            data-bs-auto-close="outside"
            data-bs-toggle="dropdown"
            hx-get="/wishlist/"
            hx-target=".dropmenu-{{item.id}}"
            hx-trigger="click"
            hx-vals='{"item_id": {{ item.id }}}'
            hx-swap="innerHTML"
          >
            <span class="visually-hidden">Toggle Dropdown</span>
          </button>

          <ul class="dropdown-menu" style="width: 20rem">
            <div class="dropmenu-{{item.id}}">
              <!-- Here will be rendered wish items after user cliks on dropdown -->
            </div>
            <li>
              <hr class="dropdown-divider">
            </li>

            <li>
              <form
                method="post"
                action="/wishlist/"
                hx-post="/wishlist/"
                hx-target=".dropmenu-{{item.id}}"
                hx-swap="beforeend"
              >
              <div class="input-group mt-3">
                <input type="hidden" name="item_id" value="{{item.id}}">
                <input
                  type="text"
                  class="form-control form-control-sm"
                  name="name"
                  placeholder="Wishlist name"/>
                <button type="submit" id="create-btn" class="btn btn-danger">Add</button>
              </div>
            </form>
            </li>
          </ul>
        </div>
    </div>
  </div>
{% endmacro -%}

<html>
  <head>
    <title>Wishlist</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.3/font/bootstrap-icons.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://unpkg.com/htmx.org@1.8.5"></script>
    <link href="data:image/x-icon;base64," rel="icon" type="image/x-icon" />

  </head>
  <body class="container" hx-headers='{"X-CSRFToken": "{{ csrf_token }}"}'>
    <h1 class="my-5 px-5">Wishlist anybody you want</h1>

    <ul class="d-flex flex-wrap justify-content-evenly gap-2">
      {% for item in items %}
        {{ card(item) }}
      {% endfor %}
    </ul>
  </body>
</html>
